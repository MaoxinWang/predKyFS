function [ky,sigma_ky] = ky_model(c_gh,tanPhi,tanBeta,D,ru)

% Created by Mao-Xin Wang (dr.maoxin.wang@gmail.com or wangmx@whu.edu.cn)
% December 2023
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% INPUT
%
%   c_gh         = c/gama/H (scalar or matrix)
%                 (where c is soil cohesion, kPa; gama is soil unit weight, kN/m3;
%                  H is slope height, m)
%   tanPhi       = tangent of soil friction angle (scalar or matrix)
%   tanBeta      = tangent of slope angle (scalar or matrix)
%   D            = slope depth ratio (scalar or matrix)
%   ru           = tangent of slope angle (scalar or matrix)
%   Note: the above inputs must be in the same matrix dimension
%
% OUTPUT
%
%   ky           = yield acceleration
%   sigma_ky     = standard deviation of ky
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Range values of inputted parameters
X_min = [0.0017 	0.0875 	0.1763 	1.0000 	0.0000];
X_max = [1.1111 	1.7321 	2.7475 	3.5000 	0.5000];

%% specify model coefficients
w1 = [
    -0.5929 	1.1877 	-1.1542 	0.4740 	-2.4065 	-0.6617 	-1.1641 	-0.3299 	-0.7805 	1.0579 	-0.3677 	-4.7840 	-2.5286 	1.3302 	-0.6628 	2.1979 	1.2590 	0.0198 	8.5191 	-3.4054 	1.4011 	-4.7132 	6.0107 	6.4564 	2.5546 	7.1233 	0.2166 	-3.1995 	5.3235 	-0.0079 	3.0206 	-2.4198
    -0.6414 	-1.4550 	1.1155 	-0.7207 	2.8180 	0.6453 	0.0383 	-0.2272 	-0.5966 	-1.0466 	-0.3306 	1.3659 	0.6802 	-0.7804 	-0.5416 	-0.4477 	-1.1212 	0.2984 	-0.3533 	-0.0910 	-0.5632 	-0.1502 	-0.4172 	0.3351 	0.2904 	-2.5242 	2.4787 	0.1956 	0.6160 	-0.3218 	-0.7766 	-2.8313
    3.6299 	0.1052 	-0.4965 	-0.0453 	-6.0896 	0.0171 	-1.5408 	-1.3172 	-3.8753 	-0.7721 	-0.5905 	5.1062 	-1.0158 	-0.0885 	-0.8722 	1.5867 	0.2129 	-0.7491 	2.3117 	0.7052 	-0.0092 	-0.0156 	-3.5744 	-1.3200 	1.1774 	-6.1750 	-0.0498 	-2.6093 	-0.4416 	-0.0089 	-0.7337 	0.3823
    0.0038 	-0.0012 	-0.0026 	-0.5757 	-0.0021 	1.9781 	0.0008 	0.0004 	-0.0030 	0.0032 	0.0007 	1.6586 	0.0011 	-0.6564 	-0.0011 	-0.0010 	0.0001 	-0.0020 	-0.0005 	-0.0002 	0.0003 	0.0001 	0.0063 	-0.0011 	-0.0020 	-8.0757 	0.0003 	-0.0011 	-0.0006 	0.0003 	0.0020 	0.0010
    -0.4448 	-0.1249 	-0.4087 	0.0376 	-1.3602 	-0.0481 	0.1299 	0.2702 	0.3095 	0.1014 	-0.4453 	-0.0570 	-0.2627 	0.0454 	-0.5222 	-0.2770 	0.1013 	-0.6586 	-0.0182 	-0.1119 	-0.3174 	-0.3267 	0.0764 	-0.2123 	0.3105 	0.2415 	0.0659 	0.0476 	0.1892 	0.0561 	-0.1770 	0.5576
    ];
w2 = [
    -0.7538 	-0.0202 	0.0523 	-0.3611 	3.0158 	-2.1989 	1.0910 	0.1212 	-0.1948 	-0.3087 	0.3482 	-0.8147 	-0.3032 	0.3882 	0.5270 	-0.3048 	-0.1709 	-0.5033 	0.3115 	1.0127 	0.1867 	-0.5301 	-0.0866 	0.1897 	-0.0228 	-0.0031 	1.2913 	-0.9744 	-1.4500 	0.3988 	-0.4986 	-0.1743
    3.7580 	0.1429 	0.0312 	4.5653 	0.6595 	-3.7753 	3.8879 	0.0505 	2.5261 	-0.4037 	-5.3906 	1.4857 	-0.1045 	-2.8825 	-0.7183 	-0.1026 	0.1008 	-1.3621 	0.2128 	-6.8363 	6.3955 	1.7513 	-0.2109 	6.1792 	-0.0690 	-0.0651 	1.8772 	0.5456 	-6.3238 	4.7768 	-3.8414 	-15.9085
    3.9516 	0.0291 	-0.0912 	1.1673 	1.2528 	0.4152 	3.6498 	0.0633 	0.2855 	0.0365 	-2.8719 	-0.2092 	-0.4070 	-2.3437 	-2.8170 	-0.0091 	0.0195 	1.0800 	0.6501 	-4.1309 	0.1214 	-0.2379 	-2.5010 	0.2945 	0.0077 	0.0047 	1.0455 	-5.0875 	-3.9601 	7.6402 	0.7498 	2.9942
    -1.0227 	0.7223 	2.5713 	1.2661 	1.7858 	-0.7110 	-0.4263 	-1.1765 	2.3915 	-2.2955 	-0.0869 	0.9094 	-0.9897 	-3.8841 	1.4508 	-0.0730 	2.3866 	-4.2287 	0.1356 	-1.8153 	3.5283 	1.3012 	0.2098 	2.2097 	-1.5614 	-1.0880 	-0.2737 	0.3759 	0.0329 	-0.3233 	-1.0302 	-6.5536
    -0.6996 	-0.0106 	-0.0415 	0.1079 	-2.1815 	-2.1844 	-0.5258 	-0.0319 	-0.0309 	0.0727 	-0.1860 	-0.1263 	0.1418 	0.0324 	0.1802 	0.0932 	0.0442 	0.0497 	-0.1610 	-0.4769 	-0.0722 	-0.0603 	0.0889 	-0.0846 	0.0190 	0.0093 	0.4716 	-0.6464 	-1.2187 	1.3278 	-0.9458 	-7.5443
    -0.0999 	0.0988 	-0.5478 	-0.0620 	-0.4638 	0.9333 	-10.3627 	-0.1566 	0.7520 	-0.1252 	-0.4195 	1.1004 	-1.0050 	-0.2087 	-0.0485 	-0.2577 	0.0222 	-0.9604 	1.0090 	-0.6874 	2.7556 	1.0023 	-0.0064 	2.3521 	-0.3986 	-0.0999 	-0.0141 	0.0032 	0.0711 	-0.0474 	-0.2519 	0.3933
    -1.7450 	-0.0310 	-0.5106 	0.0338 	10.5419 	0.2141 	0.7883 	-0.0424 	0.6144 	-0.1666 	-4.0381 	0.3262 	0.9655 	-0.6397 	-2.5510 	0.0770 	0.1180 	1.2769 	-1.0584 	-4.1748 	0.0599 	0.2399 	0.1879 	0.0432 	0.0108 	0.0010 	-4.2054 	6.3740 	-6.3944 	0.1357 	-2.5678 	-0.9456
    6.8893 	0.0081 	-0.3785 	-0.2603 	7.5021 	-5.2697 	-0.9099 	0.0555 	-0.1566 	-0.2275 	2.1614 	-1.0885 	-0.0007 	1.7111 	0.3508 	-0.1527 	-0.1024 	-1.7413 	0.0642 	4.2360 	-0.2096 	-0.6503 	-0.7801 	-0.1884 	-0.0507 	-0.0164 	1.2656 	-3.0181 	-9.9270 	5.8613 	1.5065 	-5.6387
    -4.6206 	-0.0708 	0.1740 	-2.7431 	1.7161 	-2.6459 	0.2349 	0.1137 	0.4780 	-0.9004 	-0.3946 	0.8216 	-0.3770 	-0.6953 	-0.6018 	0.0253 	0.1922 	-1.1752 	0.2804 	-1.2479 	0.0525 	0.6511 	0.1077 	0.0737 	-0.0291 	0.0652 	-3.3758 	-3.3377 	3.9494 	0.2284 	-0.3081 	-4.6461
    -3.8600 	-0.5449 	0.0814 	-0.4155 	-1.4448 	-5.4696 	0.5229 	0.1343 	0.3188 	-1.1726 	0.9729 	0.5099 	-0.7441 	-0.7225 	-0.5605 	-0.5040 	-2.1343 	-0.3817 	0.7632 	-1.0065 	2.0301 	0.4727 	-0.1557 	1.9191 	0.4212 	0.1882 	0.6278 	-1.7740 	3.7486 	0.0117 	-1.4488 	-8.1684
    -0.6915 	0.1107 	1.4539 	1.9919 	-13.5697 	8.1661 	-2.7746 	-0.0417 	-1.2845 	0.4539 	2.8376 	-0.1518 	-1.2262 	2.0525 	2.1427 	0.1203 	-0.1674 	2.9083 	1.3590 	4.6171 	-0.7144 	-0.3048 	0.7908 	-0.7386 	-0.2422 	-0.0253 	0.7055 	-1.5784 	4.4720 	-9.7985 	0.9154 	19.5329
    -0.0776 	0.0017 	0.0036 	-0.0580 	0.0028 	-0.0437 	-7.0154 	0.0043 	0.0170 	-0.1115 	0.0804 	0.0474 	0.0445 	-0.0950 	0.0593 	-0.0658 	-0.0523 	0.1075 	-0.0515 	0.0816 	0.0387 	0.0133 	-0.0128 	0.0286 	0.0151 	-0.0097 	-0.3668 	-0.0470 	-0.0074 	-0.0124 	-1.7030 	-0.0238
    0.7812 	-0.0489 	0.4886 	3.2142 	-6.7403 	3.3286 	-3.6601 	-0.1909 	-0.1225 	-0.6754 	1.4343 	0.2144 	-0.0907 	-0.9817 	0.8052 	-0.1868 	4.1232 	-1.2305 	0.0394 	0.6879 	0.9748 	0.1236 	0.4242 	0.9968 	0.1312 	-0.0547 	2.0718 	-4.0135 	14.0285 	-1.9707 	-1.3346 	9.8600
    0.1900 	-0.0026 	0.0111 	-0.0870 	-0.2776 	0.0745 	-8.8117 	-0.0780 	-0.4630 	-0.0565 	0.0572 	-0.2504 	-0.2849 	0.4598 	-0.1925 	0.2427 	-0.1137 	0.2603 	0.4154 	0.2843 	-1.4774 	-0.3359 	-0.0271 	-1.2779 	0.3459 	0.0218 	0.0809 	-0.0754 	0.0131 	0.0566 	-0.0554 	1.1446
    1.1666 	-0.0605 	0.4712 	-1.4572 	3.0525 	-0.1910 	-0.8440 	-0.0598 	-0.4211 	0.0016 	0.1119 	-0.1344 	-0.3539 	0.5886 	-0.2706 	0.0447 	-0.1866 	-0.1619 	0.4056 	1.3719 	-0.3040 	-0.2063 	-0.1437 	-0.3159 	-0.0335 	0.0146 	-0.0201 	0.8446 	-7.1570 	1.4445 	1.6119 	-6.7673
    -0.9397 	-0.0666 	0.6287 	4.6634 	-0.3521 	2.4369 	0.1425 	0.0494 	-0.5092 	1.0024 	1.1314 	-0.3873 	0.0779 	-0.0194 	0.2853 	0.0145 	-0.2633 	-0.0139 	-0.0845 	1.4146 	-0.4351 	-0.3798 	0.3241 	-0.4241 	0.1318 	0.0603 	0.3737 	-0.8494 	3.6619 	-2.1643 	-0.3832 	7.9525
    3.0317 	-0.2660 	-0.1737 	-1.1771 	0.3964 	-1.1893 	4.3915 	-0.0792 	0.1228 	-1.0711 	-2.9018 	0.3728 	0.3862 	-0.3737 	-1.9994 	-0.1564 	-1.1299 	0.1873 	-0.5534 	-2.7714 	0.6383 	0.3399 	-0.4842 	0.5401 	-0.6493 	0.0269 	-2.7372 	2.8796 	-13.4599 	2.3171 	-1.3262 	-12.2061
    -4.6201 	0.0014 	-0.3109 	-0.2966 	-3.6871 	-0.3620 	-3.1287 	-0.0480 	0.0130 	-0.3362 	0.2067 	-0.2660 	0.4233 	0.1523 	0.3658 	-0.0310 	-0.1108 	-0.0421 	-0.4674 	0.0855 	0.1965 	-0.2023 	0.2261 	0.2362 	0.0310 	-0.0265 	0.7759 	-2.2476 	7.4490 	-1.6002 	-1.3950 	6.5829
    0.1367 	-0.1496 	0.5867 	-8.0176 	0.2286 	2.9791 	-7.1930 	-0.0169 	-0.0097 	-1.6130 	0.3871 	-0.0187 	-0.8801 	-0.2672 	0.0039 	-0.4619 	-0.0744 	-1.3319 	0.8726 	0.8631 	0.6286 	-0.0941 	0.0984 	0.6533 	0.4567 	0.0127 	-0.1914 	0.0829 	1.0269 	0.1832 	0.1262 	4.8606
    0.0431 	-0.1435 	-0.5274 	-6.3518 	2.9462 	-4.2191 	-1.3360 	-0.3925 	-0.5901 	0.3787 	-5.7609 	-0.4103 	1.2290 	0.9412 	-3.6928 	0.2161 	-0.2066 	1.2137 	-1.2945 	-5.5446 	-0.8153 	-0.5203 	-0.6232 	-0.7557 	0.4144 	-0.0153 	-2.8865 	7.9321 	1.8274 	-0.0105 	0.0612 	-7.0441
    -6.2892 	0.3661 	-2.2874 	3.3321 	1.5844 	3.6684 	2.5353 	-0.6267 	1.8382 	-1.0436 	-0.6026 	2.1659 	-0.2123 	-2.5893 	0.8387 	0.1959 	4.1580 	-2.1994 	0.2422 	-3.9935 	1.6572 	1.9839 	0.8724 	1.6485 	-0.7899 	-0.5268 	3.0778 	-5.9102 	17.6544 	-1.6088 	-1.4840 	5.8992
    3.7237 	-0.1764 	-0.8505 	0.1185 	2.5758 	-0.6878 	5.8429 	0.2117 	0.5778 	1.7777 	1.1398 	0.1198 	0.3438 	0.1463 	0.5351 	0.0967 	0.8528 	-0.5314 	-0.4118 	0.3214 	-1.1579 	0.2379 	-0.0186 	-1.1560 	-0.4747 	0.0944 	-0.0631 	-0.4904 	1.6315 	2.0562 	-0.1882 	-2.5562
    -1.8050 	0.0078 	-0.0899 	-0.2774 	3.4875 	-2.5922 	-1.0086 	-0.0571 	0.1712 	-0.1402 	-0.1538 	0.2938 	-0.3365 	-0.1024 	-0.0675 	0.0053 	0.0562 	-1.0276 	0.3188 	-0.4381 	0.2605 	0.2605 	0.1121 	0.2596 	0.0174 	-0.0191 	1.3338 	-1.1054 	4.1263 	0.5749 	2.2220 	1.4971
    -3.4418 	0.0163 	-0.2581 	-1.2033 	-7.3268 	5.8949 	-4.8359 	-0.0204 	0.3069 	-0.5256 	2.0633 	-0.0794 	-0.1369 	0.5714 	1.4032 	-0.3090 	-0.3090 	-1.4745 	0.1287 	2.6819 	1.6175 	0.0281 	0.4529 	1.6502 	-0.2466 	-0.0808 	2.3312 	-2.2627 	14.4391 	-4.4883 	0.1120 	9.8286
    0.2588 	0.3759 	-1.4737 	3.3783 	-2.0367 	-3.6646 	2.7363 	-0.0749 	0.6010 	2.1077 	1.0468 	0.5816 	0.8505 	-0.7715 	0.1912 	0.2816 	3.6353 	-1.6936 	-0.9577 	0.1609 	-0.4912 	0.6195 	0.2662 	-0.5185 	-0.3158 	-0.1763 	1.1033 	-1.9696 	14.3310 	0.5635 	-1.3223 	3.9928
    -0.1709 	0.0098 	0.0360 	0.3405 	-6.8910 	0.8703 	-1.1459 	0.0130 	0.0777 	-0.2613 	1.6511 	0.0443 	0.0064 	-0.2558 	1.3170 	-0.0558 	0.0175 	-0.0140 	-0.0160 	2.5719 	0.6143 	0.0720 	0.1078 	0.5754 	-0.0230 	-0.0086 	6.1365 	-0.1441 	-0.2868 	-0.6857 	0.1794 	9.9109
    -3.1702 	-0.0207 	0.3686 	4.0267 	-6.7296 	6.0182 	-4.2305 	-0.2044 	1.3917 	0.1124 	-0.7681 	0.6205 	0.4039 	-1.5714 	1.3715 	0.3026 	1.9921 	-0.6497 	-0.4106 	-1.1530 	3.3029 	0.8148 	0.8522 	3.1884 	-0.3917 	-0.1520 	3.6871 	-2.8759 	12.6224 	-3.1376 	-3.0789 	8.7237
    3.4137 	0.5393 	-1.2090 	-6.2829 	-8.2567 	11.7553 	-1.6213 	-1.0472 	-0.1193 	-1.0946 	1.5487 	0.1956 	-0.1396 	-1.1485 	5.1262 	-1.5092 	-0.6970 	2.2012 	0.2193 	1.8534 	0.7133 	-0.0976 	0.7908 	0.6484 	0.4818 	-0.8171 	4.7377 	2.6788 	7.4712 	-5.2290 	-1.1611 	20.3737
    -4.4862 	-0.1908 	0.3690 	-3.4269 	-2.6798 	8.3526 	-1.9440 	-0.2791 	0.5101 	-1.9560 	0.3965 	0.2933 	-0.5540 	0.1350 	1.2997 	-0.8177 	1.2439 	-0.6669 	0.6229 	-0.5666 	0.7150 	0.2179 	0.6784 	0.7879 	0.0289 	-0.1361 	2.6348 	-4.6671 	7.3294 	-3.2179 	0.5566 	8.9902
    7.4471 	3.5207 	1.8133 	-2.0827 	3.7659 	-2.7061 	2.9246 	-0.6836 	-1.4569 	4.9028 	-2.1158 	-1.6285 	-1.5867 	4.6023 	-5.6656 	0.6821 	-2.7699 	-0.9679 	2.7515 	-2.6013 	-2.4584 	-2.2273 	-1.7865 	-1.2815 	3.2724 	0.2080 	-6.5432 	-3.1856 	0.5645 	3.1057 	2.0310 	-0.9892
    4.5431 	0.2910 	0.9297 	-0.4177 	-6.1052 	3.6063 	0.8744 	0.1242 	-0.6980 	1.2097 	1.4577 	-1.4420 	0.7651 	0.4310 	2.3891 	-1.7837 	3.5698 	0.6196 	-0.9023 	2.5932 	-1.2398 	-1.3010 	0.4052 	-1.1755 	1.8234 	-0.0937 	0.9411 	0.9931 	7.9719 	-1.1534 	-2.8363 	20.1936
    -3.5244 	-0.0468 	-1.2809 	0.4665 	-3.5513 	2.4949 	-2.2015 	-0.8011 	-0.4398 	-0.0755 	-0.4077 	-0.8443 	0.1464 	0.6352 	0.4232 	-0.2607 	0.6233 	1.8007 	-0.0163 	-0.3855 	0.8699 	-0.8722 	0.2499 	0.8345 	0.5795 	-0.2579 	6.3543 	-2.8957 	12.2063 	-0.8070 	-0.5095 	8.4354
    ];
w3 = [
    4.4014 	-1.8987 	0.3131 	-9.6412 	14.7977 	-0.7958 	12.1946 	1.8339 	-1.3764 	-0.2163 	-7.1374 	-2.7735 	3.0397 	0.4182 	5.1344 	0.8375 	7.0502 	-0.2372 	2.6253 	7.0554 	2.3152 	4.1489 	9.1836 	-2.4030 	0.8821 	-5.0848 	-10.4055 	-15.1045 	9.2754 	-10.4767 	9.9888 	11.1394
    ]';

b1 = [
    -3.9470 	-0.9645 	1.3828 	-1.9641 	4.8005 	3.0008 	-0.1418 	1.0654 	-5.2389 	1.0134 	0.5231 	2.2147 	-2.5250 	-0.3030 	-0.9730 	1.9074 	0.5269 	0.1771 	6.1145 	-1.7582 	1.4315 	-3.6901 	2.9812 	5.2543 	3.4764 	-8.9453 	2.6574 	-5.9653 	5.1476 	-1.0517 	2.6112 	-5.0798
    ];
b2 = [
    -2.2979 	3.5471 	3.3540 	0.6780 	-8.2782 	5.3990 	-4.4208 	-2.1068 	0.7664 	0.7201 	3.6100 	0.0465 	-2.2380 	-1.3686 	6.4975 	1.9391 	-1.3446 	-1.2268 	2.3943 	4.1595 	0.0882 	-0.4960 	2.5965 	-0.2008 	0.6300 	-1.0710 	10.2046 	-2.1556 	3.7419 	-4.5684 	-4.2375 	4.4829
    ];
b3 = [-5.5229];

%% predict factor of safety using neural network
% ensure predictors are in vector form
[n_row,n_col] = size(c_gh);
n_data = n_row*n_col;
x_c_gh = reshape(c_gh,n_data,1);
x_tanPhi = reshape(tanPhi,n_data,1);
x_tanBeta = reshape(tanBeta,n_data,1);
x_D = reshape(D,n_data,1);
x_ru = reshape(ru,n_data,1);

% normalize predictors (equation 4)
X_norm = 2*([x_c_gh,x_tanPhi,x_tanBeta,x_D,x_ru]-repmat(X_min,[n_data,1]))./(repmat(X_max-X_min,[n_data,1]))-1;

% make prediction (equation 5)
Y1 = exp((2./(1+exp(-2*((2./(1+exp(-2*(X_norm*w1+repmat(b1,[n_data,1]))))-1)*w2+repmat(b2,[n_data,1]))))-1)*w3+b3);
Y1_min = zeros(size(Y1));
Y1_max = x_c_gh./x_D+(1-x_ru).*x_tanPhi;
Y1(Y1<Y1_min) = Y1_min(Y1<Y1_min);
Y1(Y1>Y1_max) = Y1_max(Y1>Y1_max);

%% predict standard deviation using polynomial (equation 9)
Y2 = (0.00154-0.0146*x_c_gh+0.0579*x_c_gh.^2)./(1-6.352*x_c_gh+6.716*x_c_gh.^2+26.756*x_c_gh.^3);

%% make dimension of outputs consistent with that of inputs
ky = reshape(Y1,n_row,n_col);
sigma_ky = reshape(Y2,n_row,n_col);
